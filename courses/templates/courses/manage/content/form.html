{% extends "base.html" %}

{% block title %}
    {% if object %}
        Edit Konten - {{ object.title }}
    {% else %}
        Tambah Konten Baru
    {% endif %}
{% endblock %}

{% block content %}
    <!-- Header Section -->
    <div class="bg-gradient-to-r from-blue-600 to-cyan-600 text-white py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center">
                <a href="javascript:history.back()"
                   class="mr-4 w-10 h-10 bg-white bg-opacity-20 backdrop-blur-sm rounded-lg flex items-center justify-center hover:bg-opacity-30 transition">
                    <i class="fas fa-arrow-left text-white"></i>
                </a>
                <div>
                    <h1 class="text-4xl font-bold mb-2">
                        {% if object %}
                            <i class="fas fa-edit mr-3"></i>Edit Konten
                        {% else %}
                            <i class="fas fa-plus-circle mr-3"></i>Tambah Konten Baru
                        {% endif %}
                    </h1>
                    <p class="text-blue-100">
                        {% if object %}
                            Perbarui konten pembelajaran
                        {% else %}
                            Tambahkan materi pembelajaran baru ke modul
                        {% endif %}
                    </p>
                </div>
            </div>
        </div>
    </div>

    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <!-- Main Form Card -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden border border-gray-100">
            <div class="bg-gradient-to-r from-blue-50 to-cyan-50 px-8 py-6 border-b border-blue-100">
                <h2 class="text-2xl font-bold text-gray-900 flex items-center">
                    <i class="fas fa-file-alt text-blue-600 mr-3"></i>
                    Informasi Konten
                </h2>
                <p class="text-gray-600 mt-2 text-sm">
                    {% if object %}
                        Ubah informasi konten pembelajaran di bawah ini
                    {% else %}
                        Isi detail konten yang ingin Anda tambahkan
                    {% endif %}
                </p>
            </div>

            <form method="post" enctype="multipart/form-data" class="p-8" id="content-form">
                {% csrf_token %}

                <!-- Form Fields -->
                <div class="space-y-6">
                    {% for field in form %}
                        <div class="form-group">
                            <label for="{{ field.id_for_label }}"
                                   class="block text-sm font-semibold text-gray-900 mb-2">
                                {{ field.label }}
                                {% if field.field.required %}
                                    <span class="text-red-500">*</span>
                                {% endif %}
                            </label>

                            {% if field.name == 'content' %}
                                <!-- Rich text area for content -->
                                <textarea name="{{ field.name }}"
                                          id="{{ field.id_for_label }}"
                                          rows="12"
                                          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition resize-none font-mono text-sm"
                                          {% if field.field.required %}required{% endif %}
                                          placeholder="Tulis konten pembelajaran Anda di sini... Anda bisa menggunakan Markdown untuk formatting.">{{ field.value|default:'' }}</textarea>
                                <p class="mt-2 text-sm text-gray-500">
                                    <i class="fas fa-info-circle mr-1"></i>
                                    Gunakan Markdown untuk format teks (bold, italic, list, dll)
                                </p>
                            {% elif field.name == 'url' %}
                                <!-- URL input for video -->
                                <input type="url"
                                       name="{{ field.name }}"
                                       id="{{ field.id_for_label }}"
                                       value="{{ field.value|default:'' }}"
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition"
                                       {% if field.field.required %}required{% endif %}
                                       placeholder="https://www.youtube.com/watch?v=...">
                                <p class="mt-2 text-sm text-gray-500">
                                    <i class="fas fa-info-circle mr-1"></i>
                                    Masukkan URL video YouTube atau platform video lainnya
                                </p>
                            {% elif field.name == 'file' %}
                                <!-- File upload -->
                                <div class="flex items-center justify-center w-full">
                                    <label for="{{ field.id_for_label }}"
                                           class="flex flex-col items-center justify-center w-full h-40 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 transition">
                                        <div class="flex flex-col items-center justify-center pt-5 pb-6">
                                            <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-3"></i>
                                            <p class="mb-2 text-sm text-gray-500">
                                                <span class="font-semibold">Klik untuk upload</span> atau drag & drop
                                            </p>
                                            <p class="text-xs text-gray-500">
                                                {% if 'image' in field.id_for_label %}
                                                    PNG, JPG, GIF (MAX. 5MB)
                                                {% else %}
                                                    PDF, DOC, DOCX, atau file lainnya (MAX. 10MB)
                                                {% endif %}
                                            </p>
                                        </div>
                                        <input type="file"
                                               name="{{ field.name }}"
                                               id="{{ field.id_for_label }}"
                                               class="hidden"
                                               {% if field.field.required and not object %}required{% endif %}
                                               onchange="displayFileName(this)">
                                    </label>
                                </div>
                                <p id="file-name" class="mt-2 text-sm text-gray-600 hidden"></p>
                                {% if object and field.value %}
                                    <div class="mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                                        <p class="text-sm text-blue-800">
                                            <i class="fas fa-file mr-2"></i>
                                            File saat ini: <strong>{{ field.value }}</strong>
                                        </p>
                                    </div>
                                {% endif %}
                            {% else %}
                                <!-- Default text input -->
                                <input type="text"
                                       name="{{ field.name }}"
                                       id="{{ field.id_for_label }}"
                                       value="{{ field.value|default:'' }}"
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition"
                                       {% if field.field.required %}required{% endif %}
                                       placeholder="Masukkan {{ field.label|lower }}">
                            {% endif %}

                            {% if field.help_text and field.name != 'content' and field.name != 'url' %}
                                <p class="mt-2 text-sm text-gray-500">
                                    <i class="fas fa-info-circle mr-1"></i>{{ field.help_text }}
                                </p>
                            {% endif %}

                            {% if field.errors %}
                                <div class="mt-2 text-sm text-red-600">
                                    <i class="fas fa-exclamation-circle mr-1"></i>
                                    {{ field.errors.0 }}
                                </div>
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>

                <!-- Action Buttons -->
                <div class="mt-8 pt-6 border-t border-gray-200 flex flex-col sm:flex-row items-center justify-between gap-4">
                    <a href="javascript:history.back()"
                       class="w-full sm:w-auto inline-flex items-center justify-center px-6 py-3 border border-gray-300 rounded-lg text-gray-700 bg-white hover:bg-gray-50 font-medium transition shadow-sm">
                        <i class="fas fa-times mr-2"></i>
                        Batal
                    </a>
                    <button type="submit"
                            id="submit-btn"
                            class="w-full sm:w-auto inline-flex items-center justify-center px-8 py-3 bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 text-white font-semibold rounded-lg transition shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed">
                        <i class="fas fa-save mr-2" id="submit-icon"></i>
                        <span id="submit-text">{% if object %}Simpan Perubahan{% else %}Tambah Konten{% endif %}</span>
                    </button>
                </div>
            </form>
        </div>

        <!-- Help Card -->
        <div class="mt-6 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl p-6 border border-indigo-100">
            <h3 class="text-lg font-bold text-gray-900 mb-3 flex items-center">
                <i class="fas fa-lightbulb text-yellow-500 mr-2"></i>
                Tips Membuat Konten Berkualitas
            </h3>
            <ul class="space-y-2 text-sm text-gray-700">
                <li class="flex items-start">
                    <i class="fas fa-check-circle text-green-600 mr-2 mt-0.5"></i>
                    <span>Gunakan judul yang jelas dan deskriptif</span>
                </li>
                <li class="flex items-start">
                    <i class="fas fa-check-circle text-green-600 mr-2 mt-0.5"></i>
                    <span>Untuk teks, gunakan paragraf pendek dan mudah dibaca</span>
                </li>
                <li class="flex items-start">
                    <i class="fas fa-check-circle text-green-600 mr-2 mt-0.5"></i>
                    <span>Untuk video, pastikan URL dapat diakses oleh siswa</span>
                </li>
                <li class="flex items-start">
                    <i class="fas fa-check-circle text-green-600 mr-2 mt-0.5"></i>
                    <span>Untuk gambar dan file, gunakan ukuran file yang wajar</span>
                </li>
            </ul>
        </div>
    </div>

    <script>
        function displayFileName(input) {
            const fileNameDisplay = document.getElementById('file-name');
            if (input.files && input.files[0]) {
                fileNameDisplay.textContent = 'File terpilih: ' + input.files[0].name;
                fileNameDisplay.classList.remove('hidden');
                fileNameDisplay.classList.add('text-green-600', 'font-medium');
            }
        }

        // Form submission handler with loading state
        document.getElementById('content-form').addEventListener('submit', function (e) {
            const submitBtn = document.getElementById('submit-btn');
            const submitIcon = document.getElementById('submit-icon');
            const submitText = document.getElementById('submit-text');

            // Show loading state
            submitBtn.disabled = true;
            submitIcon.className = 'fas fa-spinner fa-spin mr-2';
            submitText.textContent = 'Menyimpan...';
        });

        // Auto-save draft functionality (optional enhancement)
        let autoSaveTimer;
        const formInputs = document.querySelectorAll('#content-form input, #content-form textarea');

        formInputs.forEach(input => {
            if (input.type !== 'file') {
                input.addEventListener('input', function () {
                    clearTimeout(autoSaveTimer);
                    autoSaveTimer = setTimeout(() => {
                        // Show auto-save indicator
                        console.log('Auto-saving draft...');
                    }, 3000);
                });
            }
        });
    </script>
{% endblock %}