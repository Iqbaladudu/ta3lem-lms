{% extends "base.html" %}

{% block title %}Tambah {{ model_name|title }} ke {{ content.title }}{% endblock %}

{% block content %}
    <!-- Header Section -->
    <div class="bg-gradient-to-r from-green-600 to-emerald-600 text-white py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center">
                <a href="{% url 'module_content_list' content.module.id %}"
                   class="mr-4 w-10 h-10 bg-white bg-opacity-20 backdrop-blur-sm rounded-lg flex items-center justify-center hover:bg-opacity-30 transition">
                    <i class="fas fa-arrow-left text-white"></i>
                </a>
                <div>
                    <h1 class="text-4xl font-bold mb-2">
                        <i class="fas fa-plus-circle mr-3"></i>Tambah {{ model_name|title }}
                    </h1>
                    <p class="text-green-100">
                        Ke konten: {{ content.title }}
                    </p>
                </div>
            </div>
        </div>
    </div>

    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <!-- Main Form Card -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden border border-gray-100">
            <div class="bg-gradient-to-r from-green-50 to-emerald-50 px-8 py-6 border-b border-green-100">
                <h2 class="text-2xl font-bold text-gray-900 flex items-center">
                    {% if model_name == 'text' %}
                        <i class="fas fa-align-left text-blue-600 mr-3"></i>
                    {% elif model_name == 'video' %}
                        <i class="fas fa-video text-red-600 mr-3"></i>
                    {% elif model_name == 'image' %}
                        <i class="fas fa-image text-purple-600 mr-3"></i>
                    {% elif model_name == 'file' %}
                        <i class="fas fa-file text-orange-600 mr-3"></i>
                    {% endif %}
                    Tambah {{ model_name|title }}
                </h2>
                <p class="text-gray-600 mt-2 text-sm">
                    Isi detail item yang ingin Anda tambahkan ke "{{ content.title }}"
                </p>
            </div>

            <form method="post" enctype="multipart/form-data" class="p-8" id="item-form">
                {% csrf_token %}

                <!-- Form Fields -->
                <div class="space-y-6">
                    {% for field in form %}
                        <div class="form-group">
                            <label for="{{ field.id_for_label }}"
                                   class="block text-sm font-semibold text-gray-900 mb-2">
                                {{ field.label }}
                                {% if field.field.required %}
                                    <span class="text-red-500">*</span>
                                {% endif %}
                            </label>

                            {% if field.name == 'content' %}
                                <!-- Rich text area for content -->
                                <textarea name="{{ field.name }}"
                                          id="{{ field.id_for_label }}"
                                          rows="12"
                                          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition resize-none font-mono text-sm"
                                          {% if field.field.required %}required{% endif %}
                                          placeholder="Tulis konten pembelajaran Anda di sini... Anda bisa menggunakan Markdown untuk formatting.">{{ field.value|default:'' }}</textarea>
                                <p class="mt-2 text-sm text-gray-500">
                                    <i class="fas fa-info-circle mr-1"></i>
                                    Gunakan Markdown untuk format teks (bold, italic, list, dll)
                                </p>
                            {% elif field.name == 'url' %}
                                <!-- URL input for video -->
                                <input type="url"
                                       name="{{ field.name }}"
                                       id="{{ field.id_for_label }}"
                                       value="{{ field.value|default:'' }}"
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition"
                                       {% if field.field.required %}required{% endif %}
                                       placeholder="https://www.youtube.com/watch?v=...">
                                <p class="mt-2 text-sm text-gray-500">
                                    <i class="fas fa-info-circle mr-1"></i>
                                    Masukkan URL video YouTube atau platform video lainnya
                                </p>
                            {% elif field.name == 'file' %}
                                <!-- File upload -->
                                <div class="flex items-center justify-center w-full">
                                    <label for="{{ field.id_for_label }}"
                                           class="flex flex-col items-center justify-center w-full h-40 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 transition">
                                        <div class="flex flex-col items-center justify-center pt-5 pb-6">
                                            <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-3"></i>
                                            <p class="mb-2 text-sm text-gray-500">
                                                <span class="font-semibold">Klik untuk upload</span> atau drag & drop
                                            </p>
                                            <p class="text-xs text-gray-500">
                                                {% if model_name == 'image' %}
                                                    PNG, JPG, GIF (MAX. 5MB)
                                                {% else %}
                                                    PDF, DOC, DOCX, atau file lainnya (MAX. 10MB)
                                                {% endif %}
                                            </p>
                                        </div>
                                        <input type="file"
                                               name="{{ field.name }}"
                                               id="{{ field.id_for_label }}"
                                               class="hidden"
                                               {% if field.field.required %}required{% endif %}
                                               onchange="displayFileName(this)">
                                    </label>
                                </div>
                                <p id="file-name" class="mt-2 text-sm text-gray-600 hidden"></p>
                            {% else %}
                                <!-- Default text input -->
                                <input type="text"
                                       name="{{ field.name }}"
                                       id="{{ field.id_for_label }}"
                                       value="{{ field.value|default:'' }}"
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition"
                                       {% if field.field.required %}required{% endif %}
                                       placeholder="Masukkan {{ field.label|lower }}">
                            {% endif %}

                            {% if field.help_text and field.name != 'content' and field.name != 'url' %}
                                <p class="mt-2 text-sm text-gray-500">
                                    <i class="fas fa-info-circle mr-1"></i>{{ field.help_text }}
                                </p>
                            {% endif %}

                            {% if field.errors %}
                                <div class="mt-2 text-sm text-red-600">
                                    <i class="fas fa-exclamation-circle mr-1"></i>
                                    {{ field.errors.0 }}
                                </div>
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>

                <!-- Action Buttons -->
                <div class="mt-8 pt-6 border-t border-gray-200 flex flex-col sm:flex-row items-center justify-between gap-4">
                    <a href="{% url 'module_content_list' content.module.id %}"
                       class="w-full sm:w-auto inline-flex items-center justify-center px-6 py-3 border border-gray-300 rounded-lg text-gray-700 bg-white hover:bg-gray-50 font-medium transition shadow-sm">
                        <i class="fas fa-times mr-2"></i>
                        Batal
                    </a>
                    <button type="submit"
                            id="submit-btn"
                            class="w-full sm:w-auto inline-flex items-center justify-center px-8 py-3 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white font-semibold rounded-lg transition shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed">
                        <i class="fas fa-plus mr-2" id="submit-icon"></i>
                        <span id="submit-text">Tambah Item</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        function displayFileName(input) {
            const fileNameDisplay = document.getElementById('file-name');
            if (input.files && input.files[0]) {
                fileNameDisplay.textContent = 'File terpilih: ' + input.files[0].name;
                fileNameDisplay.classList.remove('hidden');
                fileNameDisplay.classList.add('text-green-600', 'font-medium');
            }
        }

        // Form submission handler with loading state
        document.getElementById('item-form').addEventListener('submit', function (e) {
            const submitBtn = document.getElementById('submit-btn');
            const submitIcon = document.getElementById('submit-icon');
            const submitText = document.getElementById('submit-text');

            // Show loading state
            submitBtn.disabled = true;
            submitIcon.className = 'fas fa-spinner fa-spin mr-2';
            submitText.textContent = 'Menyimpan...';
        });
    </script>
{% endblock %}
