{% extends 'base.html' %}
{% load static %}
{% block title %}Status Pembayaran - {{ order.order_number }}{% endblock %}
{% block extra_css %}
    <style>
    /* Success animation */
    @keyframes successPulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.05); }
    }
    
    @keyframes checkDraw {
        0% { stroke-dashoffset: 100; }
        100% { stroke-dashoffset: 0; }
    }
    
    @keyframes spinnerPulse {
        0%, 100% { opacity: 0.4; }
        50% { opacity: 1; }
    }
    
    .success-pulse {
        animation: successPulse 2s ease-in-out infinite;
    }
    
    .spinner-dot {
        animation: spinnerPulse 1.5s ease-in-out infinite;
    }
    
    .spinner-dot:nth-child(2) { animation-delay: 0.2s; }
    .spinner-dot:nth-child(3) { animation-delay: 0.4s; }
    </style>
{% endblock %}
{% block content %}
    <div class="min-h-screen bg-gradient-to-br from-primary-50 to-primary-100 py-8 sm:py-12">
        <div class="max-w-xl mx-auto px-4">
            <div class="bg-white rounded-3xl shadow-2xl overflow-hidden">
                <!-- Status Header -->
                {% if order.status == 'completed' %}
                    <!-- SUCCESS -->
                    <div class="bg-gradient-to-r from-green-500 via-green-600 to-emerald-600 p-8 sm:p-10 text-white text-center relative overflow-hidden">
                        <div class="absolute inset-0 bg-[radial-gradient(circle_at_30%_50%,rgba(255,255,255,0.1),transparent)]"></div>
                        <div class="success-pulse relative w-24 h-24 mx-auto mb-6">
                            <div class="absolute inset-0 bg-white/20 rounded-full"></div>
                            <div class="absolute inset-3 bg-white rounded-full flex items-center justify-center shadow-lg">
                                <i class="fas fa-check text-4xl text-green-600"></i>
                            </div>
                        </div>
                        <h1 class="text-2xl sm:text-3xl font-bold relative">Pembayaran Berhasil!</h1>
                        <p class="text-green-100 mt-2 relative">Selamat! Anda sekarang memiliki akses ke kursus</p>
                    </div>
                {% elif order.status == 'awaiting_verification' %}
                    <!-- AWAITING VERIFICATION -->
                    <div class="bg-gradient-to-r from-blue-500 via-blue-600 to-indigo-600 p-8 sm:p-10 text-white text-center relative overflow-hidden">
                        <div class="absolute inset-0 bg-[radial-gradient(circle_at_70%_50%,rgba(255,255,255,0.1),transparent)]"></div>
                        <div class="relative w-24 h-24 mx-auto mb-6">
                            <div class="absolute inset-0 bg-white/20 rounded-full"></div>
                            <div class="absolute inset-3 bg-white rounded-full flex items-center justify-center shadow-lg">
                                <i class="fas fa-hourglass-half text-4xl text-blue-600"></i>
                            </div>
                        </div>
                        <h1 class="text-2xl sm:text-3xl font-bold relative">Menunggu Verifikasi</h1>
                        <p class="text-blue-100 mt-2 relative">Tim kami akan memverifikasi pembayaran Anda dalam 1x24 jam</p>
                    </div>
                {% elif order.status == 'pending' %}
                    <!-- PENDING PAYMENT -->
                    <div class="bg-gradient-to-r from-amber-500 via-orange-500 to-orange-600 p-8 sm:p-10 text-white text-center relative overflow-hidden">
                        <div class="absolute inset-0 bg-[radial-gradient(circle_at_30%_50%,rgba(255,255,255,0.1),transparent)]"></div>
                        <div class="relative w-24 h-24 mx-auto mb-6">
                            <div class="absolute inset-0 bg-white/20 rounded-full"></div>
                            <div class="absolute inset-3 bg-white rounded-full flex items-center justify-center shadow-lg">
                                <i class="fas fa-clock text-4xl text-orange-600"></i>
                            </div>
                        </div>
                        <h1 class="text-2xl sm:text-3xl font-bold relative">Menunggu Pembayaran</h1>
                        <p class="text-orange-100 mt-2 relative">Silakan selesaikan pembayaran Anda</p>
                        {% if order.expires_at %}
                            <div class="mt-4 inline-flex items-center gap-2 bg-white/20 backdrop-blur-sm px-4 py-2 rounded-full text-sm">
                                <i class="fas fa-stopwatch"></i>
                                <span>Bayar sebelum {{ order.expires_at|date:"d M Y, H:i" }}</span>
                            </div>
                        {% endif %}
                    </div>
                {% elif order.status == 'processing' %}
                    <!-- PROCESSING -->
                    <div class="bg-gradient-to-r from-purple-500 via-purple-600 to-indigo-600 p-8 sm:p-10 text-white text-center relative overflow-hidden">
                        <div class="absolute inset-0 bg-[radial-gradient(circle_at_70%_50%,rgba(255,255,255,0.1),transparent)]"></div>
                        <div class="relative w-24 h-24 mx-auto mb-6">
                            <div class="absolute inset-0 bg-white/20 rounded-full animate-pulse"></div>
                            <div class="absolute inset-3 bg-white rounded-full flex items-center justify-center shadow-lg">
                                <div class="flex gap-1">
                                    <div class="w-2 h-2 bg-purple-600 rounded-full spinner-dot"></div>
                                    <div class="w-2 h-2 bg-purple-600 rounded-full spinner-dot"></div>
                                    <div class="w-2 h-2 bg-purple-600 rounded-full spinner-dot"></div>
                                </div>
                            </div>
                        </div>
                        <h1 class="text-2xl sm:text-3xl font-bold relative">Sedang Diproses</h1>
                        <p class="text-purple-100 mt-2 relative">Pembayaran Anda sedang dalam proses verifikasi</p>
                    </div>
                {% elif order.status == 'failed' %}
                    <!-- FAILED -->
                    <div class="bg-gradient-to-r from-red-500 via-red-600 to-rose-600 p-8 sm:p-10 text-white text-center relative overflow-hidden">
                        <div class="absolute inset-0 bg-[radial-gradient(circle_at_30%_50%,rgba(255,255,255,0.1),transparent)]"></div>
                        <div class="relative w-24 h-24 mx-auto mb-6">
                            <div class="absolute inset-0 bg-white/20 rounded-full"></div>
                            <div class="absolute inset-3 bg-white rounded-full flex items-center justify-center shadow-lg">
                                <i class="fas fa-times text-4xl text-red-600"></i>
                            </div>
                        </div>
                        <h1 class="text-2xl sm:text-3xl font-bold relative">Pembayaran Gagal</h1>
                        {% if order.rejection_reason %}
                            <p class="text-red-100 mt-2 relative">{{ order.rejection_reason }}</p>
                        {% else %}
                            <p class="text-red-100 mt-2 relative">Maaf, pembayaran Anda tidak dapat diproses</p>
                        {% endif %}
                    </div>
                {% elif order.status == 'cancelled' %}
                    <!-- CANCELLED -->
                    <div class="bg-gradient-to-r from-gray-500 via-gray-600 to-slate-600 p-8 sm:p-10 text-white text-center relative overflow-hidden">
                        <div class="relative w-24 h-24 mx-auto mb-6">
                            <div class="absolute inset-0 bg-white/20 rounded-full"></div>
                            <div class="absolute inset-3 bg-white rounded-full flex items-center justify-center shadow-lg">
                                <i class="fas fa-ban text-4xl text-gray-600"></i>
                            </div>
                        </div>
                        <h1 class="text-2xl sm:text-3xl font-bold relative">Pembayaran Dibatalkan</h1>
                        <p class="text-gray-100 mt-2 relative">Order ini telah dibatalkan</p>
                    </div>
                {% else %}
                    <!-- DEFAULT/OTHER -->
                    <div class="bg-gradient-to-r from-primary-500 to-primary-700 p-8 sm:p-10 text-white text-center">
                        <div class="relative w-24 h-24 mx-auto mb-6">
                            <div class="absolute inset-0 bg-white/20 rounded-full"></div>
                            <div class="absolute inset-3 bg-white rounded-full flex items-center justify-center shadow-lg">
                                <i class="fas fa-info text-4xl text-primary-600"></i>
                            </div>
                        </div>
                        <h1 class="text-2xl sm:text-3xl font-bold">{{ order.get_status_display }}</h1>
                    </div>
                {% endif %}
                <!-- Order Details -->
                <div class="p-6 sm:p-8">
                    <!-- Item Info -->
                    <div class="bg-primary-50 rounded-2xl p-4 mb-6 border border-primary-100">
                        <div class="flex items-center gap-4">
                            {% if order.item.image %}
                                <img src="{{ order.item.image.url }}"
                                     alt="{{ order.item }}"
                                     class="w-16 h-16 rounded-xl object-cover shadow-md">
                            {% else %}
                                <div class="w-16 h-16 rounded-xl bg-gradient-to-br from-primary-600 to-primary-800 flex items-center justify-center shadow-md">
                                    <i class="fas fa-graduation-cap text-xl text-white/50"></i>
                                </div>
                            {% endif %}
                            <div class="flex-1 min-w-0">
                                <h3 class="font-semibold text-primary-900 line-clamp-2">{{ order.item }}</h3>
                                <p class="text-sm text-primary-500 capitalize">{{ order.order_type }}</p>
                            </div>
                        </div>
                    </div>
                    <!-- Transaction Details -->
                    <div class="space-y-0 divide-y divide-primary-100">
                        <div class="flex justify-between py-3">
                            <span class="text-primary-500">Nomor Order</span>
                            <span class="font-mono font-semibold text-primary-900">{{ order.order_number }}</span>
                        </div>
                        <div class="flex justify-between py-3">
                            <span class="text-primary-500">Total Pembayaran</span>
                            <span class="font-bold text-lg text-primary-900">{{ order.get_formatted_total }}</span>
                        </div>
                        <div class="flex justify-between py-3">
                            <span class="text-primary-500">Metode Pembayaran</span>
                            <span class="text-primary-900">
                                {% if order.payment_provider %}
                                    {{ order.payment_provider.display_name }}
                                {% else %}
                                    -
                                {% endif %}
                            </span>
                        </div>
                        <div class="flex justify-between py-3">
                            <span class="text-primary-500">Tanggal Order</span>
                            <span class="text-primary-900">{{ order.created_at|date:"d M Y, H:i" }}</span>
                        </div>
                        {% if order.paid_at %}
                            <div class="flex justify-between py-3">
                                <span class="text-primary-500">Tanggal Bayar</span>
                                <span class="text-green-600 font-medium">{{ order.paid_at|date:"d M Y, H:i" }}</span>
                            </div>
                        {% endif %}
                    </div>
                    <!-- Payment Proof Preview -->
                    {% if order.payment_proof %}
                        <div class="mt-6 p-4 bg-primary-50 rounded-xl border border-primary-100">
                            <p class="text-sm font-semibold text-primary-700 mb-3">
                                <i class="fas fa-image mr-2"></i>Bukti Transfer
                            </p>
                            <a href="{{ order.payment_proof.url }}"
                               target="_blank"
                               class="block group">
                                <img src="{{ order.payment_proof.url }}"
                                     alt="Bukti Transfer"
                                     class="max-h-40 rounded-lg border border-primary-200 group-hover:ring-2 group-hover:ring-primary-400 transition">
                            </a>
                        </div>
                    {% endif %}
                </div>
                <!-- Actions -->
                <div class="p-6 sm:p-8 bg-primary-50 border-t border-primary-100 space-y-3">
                    {% if order.status == 'completed' %}
                        {% if order.order_type == 'course' %}
                            <a href="{% url 'student_course_detail' pk=order.object_id %}"
                               class="block w-full bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white font-bold py-4 rounded-2xl text-center shadow-lg hover:shadow-xl transition-all transform hover:-translate-y-0.5">
                                <i class="fas fa-play-circle mr-2"></i>
                                Mulai Belajar Sekarang
                            </a>
                        {% endif %}
                    {% elif order.status == 'awaiting_verification' %}
                        {% if not order.payment_proof %}
                            <a href="{% url 'payments:upload_proof' order.order_number %}"
                               class="block w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-bold py-4 rounded-2xl text-center shadow-lg hover:shadow-xl transition-all transform hover:-translate-y-0.5">
                                <i class="fas fa-upload mr-2"></i>
                                Upload Bukti Transfer
                            </a>
                        {% else %}
                            <div class="bg-blue-100 text-blue-800 p-4 rounded-xl text-center">
                                <i class="fas fa-spinner fa-spin mr-2"></i>
                                Bukti transfer sedang diverifikasi oleh tim kami...
                            </div>
                        {% endif %}
                    {% elif order.status == 'pending' %}
                        <a href="{% url 'payments:transfer_instructions' order.order_number %}"
                           class="block w-full bg-gradient-to-r from-primary-600 to-primary-700 hover:from-primary-700 hover:to-primary-800 text-white font-bold py-4 rounded-2xl text-center shadow-lg hover:shadow-xl transition-all transform hover:-translate-y-0.5">
                            <i class="fas fa-money-bill-wave mr-2"></i>
                            Lihat Instruksi Pembayaran
                        </a>
                    {% elif order.status == 'failed' or order.status == 'cancelled' %}
                        <a href="{% url 'payments:checkout' order.order_type order.object_id %}"
                           class="block w-full bg-gradient-to-r from-primary-600 to-primary-700 hover:from-primary-700 hover:to-primary-800 text-white font-bold py-4 rounded-2xl text-center shadow-lg hover:shadow-xl transition-all transform hover:-translate-y-0.5">
                            <i class="fas fa-redo mr-2"></i>
                            Coba Lagi
                        </a>
                    {% endif %}
                    <a href="{% url 'student_course_list' %}"
                       class="block w-full text-center text-primary-600 hover:text-primary-900 font-medium py-3 transition-colors">
                        <i class="fas fa-arrow-left mr-2"></i>
                        Kembali ke Dashboard
                    </a>
                </div>
                <!-- Help Section -->
                <div class="p-6 text-center border-t border-primary-100">
                    <p class="text-sm text-primary-500 mb-2">Butuh bantuan?</p>
                    <a href="mailto:support@ta3lem.com"
                       class="text-primary-600 hover:text-primary-800 font-semibold inline-flex items-center gap-2 transition-colors">
                        <i class="fas fa-headset"></i>
                        Hubungi Kami
                    </a>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
