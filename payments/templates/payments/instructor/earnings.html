{% extends 'base.html' %}
{% load static %}
{% block title %}Pendapatan Saya - Ta3lem{% endblock %}
{% block content %}
    <div class="min-h-screen bg-gradient-to-br from-stone-50 to-stone-100 py-8">
        <div class="max-w-6xl mx-auto px-4">
            <!-- Header -->
            <div class="mb-8">
                <h1 class="text-3xl font-bold text-stone-900">Pendapatan Saya</h1>
                <p class="text-stone-600 mt-2">Kelola pendapatan dan payout dari kursus Anda</p>
            </div>
            <!-- Balance Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <!-- Total Earned -->
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <div class="flex items-center gap-4">
                        <div class="h-12 w-12 rounded-xl bg-blue-100 text-blue-600 flex items-center justify-center text-xl">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div>
                            <p class="text-sm font-medium text-stone-500">Total Pendapatan</p>
                            <p class="text-2xl font-bold text-stone-900">
                                {% if balance.currency == 'IDR' %}
                                    Rp {{ balance.total_earned|floatformat:0 }}
                                {% else %}
                                    {{ balance.currency }} {{ balance.total_earned|floatformat:2 }}
                                {% endif %}
                            </p>
                        </div>
                    </div>
                </div>
                <!-- Available Balance -->
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <div class="flex items-center gap-4">
                        <div class="h-12 w-12 rounded-xl bg-green-100 text-green-600 flex items-center justify-center text-xl">
                            <i class="fas fa-wallet"></i>
                        </div>
                        <div>
                            <p class="text-sm font-medium text-stone-500">Saldo Tersedia</p>
                            <p class="text-2xl font-bold text-green-600">
                                {% if balance.currency == 'IDR' %}
                                    Rp {{ balance.available_balance|floatformat:0 }}
                                {% else %}
                                    {{ balance.currency }} {{ balance.available_balance|floatformat:2 }}
                                {% endif %}
                            </p>
                        </div>
                    </div>
                </div>
                <!-- Pending Payouts -->
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <div class="flex items-center gap-4">
                        <div class="h-12 w-12 rounded-xl bg-orange-100 text-orange-600 flex items-center justify-center text-xl">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div>
                            <p class="text-sm font-medium text-stone-500">Payout Pending</p>
                            <p class="text-2xl font-bold text-orange-600">
                                {% if balance.currency == 'IDR' %}
                                    Rp {{ balance.pending_payouts|floatformat:0 }}
                                {% else %}
                                    {{ balance.currency }} {{ balance.pending_payouts|floatformat:2 }}
                                {% endif %}
                            </p>
                        </div>
                    </div>
                </div>
                <!-- Paid Out -->
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <div class="flex items-center gap-4">
                        <div class="h-12 w-12 rounded-xl bg-purple-100 text-purple-600 flex items-center justify-center text-xl">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div>
                            <p class="text-sm font-medium text-stone-500">Sudah Ditarik</p>
                            <p class="text-2xl font-bold text-stone-900">
                                {% if balance.currency == 'IDR' %}
                                    Rp {{ balance.paid_out|floatformat:0 }}
                                {% else %}
                                    {{ balance.currency }} {{ balance.paid_out|floatformat:2 }}
                                {% endif %}
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Payout Button -->
            {% if balance.can_request_payout %}
                <div class="mb-8">
                    <a href="{% url 'payments:request_payout' %}"
                       class="inline-flex items-center gap-2 bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white font-semibold py-3 px-6 rounded-xl shadow-lg hover:shadow-xl transition">
                        <i class="fas fa-money-bill-wave"></i>
                        Request Payout
                    </a>
                </div>
            {% else %}
                <div class="mb-8 p-4 bg-orange-50 border border-orange-200 rounded-xl text-orange-700">
                    <i class="fas fa-info-circle mr-2"></i>
                    Minimum payout:
                    {% if balance.currency == 'IDR' %}
                        Rp {{ balance.minimum_payout|floatformat:0 }}
                    {% else %}
                        {{ balance.currency }} {{ balance.minimum_payout|floatformat:2 }}
                    {% endif %}
                </div>
            {% endif %}
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Recent Earnings -->
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
                    <div class="px-6 py-4 border-b border-stone-200 bg-stone-50">
                        <h2 class="text-lg font-semibold text-stone-900">Pendapatan Terbaru</h2>
                    </div>
                    <div class="divide-y divide-stone-100">
                        {% for earning in recent_earnings %}
                            <div class="px-6 py-4 flex justify-between items-center">
                                <div>
                                    <p class="font-medium text-stone-900">Order #{{ earning.order.order_number }}</p>
                                    <p class="text-sm text-stone-500">{{ earning.created_at|date:"d M Y, H:i" }}</p>
                                </div>
                                <div class="text-right">
                                    <p class="font-bold text-green-600">+{{ earning.get_formatted_earning }}</p>
                                    <p class="text-xs text-stone-500">(fee {{ earning.commission_rate }}%)</p>
                                </div>
                            </div>
                        {% empty %}
                            <div class="px-6 py-8 text-center text-stone-500">Belum ada pendapatan</div>
                        {% endfor %}
                    </div>
                </div>
                <!-- Recent Payouts -->
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
                    <div class="px-6 py-4 border-b border-stone-200 bg-stone-50">
                        <h2 class="text-lg font-semibold text-stone-900">Riwayat Payout</h2>
                    </div>
                    <div class="divide-y divide-stone-100">
                        {% for payout in payouts %}
                            <a href="{% url 'payments:payout_detail' payout.pk %}"
                               class="block px-6 py-4 hover:bg-stone-50 transition">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <p class="font-medium text-stone-900">{{ payout.get_formatted_amount }}</p>
                                        <p class="text-sm text-stone-500">{{ payout.requested_at|date:"d M Y" }}</p>
                                    </div>
                                    <span class="px-3 py-1 rounded-full text-xs font-semibold {% if payout.status == 'completed' %}bg-green-100 text-green-700 {% elif payout.status == 'pending' %}bg-orange-100 text-orange-700 {% elif payout.status == 'rejected' %}bg-red-100 text-red-700 {% else %}bg-blue-100 text-blue-700{% endif %}">
                                        {{ payout.get_status_display }}
                                    </span>
                                </div>
                            </a>
                        {% empty %}
                            <div class="px-6 py-8 text-center text-stone-500">Belum ada riwayat payout</div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
